<!doctype html>
<html lang="pt-br" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Finanças • Ganhos & Gastos</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0d6efd">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Finanças">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="167x167" href="assets/icons/apple-touch-icon-167.png">
  <link rel="apple-touch-icon" sizes="152x152" href="assets/icons/apple-touch-icon-152.png">


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="assets/css/app.css?v=1.2.0">
</head>

<body>
  <header class="appbar">
    <div class="container-fluid px-3 py-2 d-flex align-items-center justify-content-between gap-2">
      <div class="d-flex align-items-center gap-2">
        <div class="app-icon"><i class="bi bi-cash-coin"></i></div>
        <div class="lh-sm">
          <div class="fw-semibold">Finanças</div>
          <div class="small text-secondary">ganhos • gastos • categorias</div>
        </div>
      </div>

      <div class="d-flex align-items-center gap-2">
        <button class="btn btn-sm btn-outline-secondary" id="btnTheme" title="Tema">
          <i class="bi bi-moon-stars"></i>
        </button>
        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#filters">
          <i class="bi bi-sliders"></i>
        </button>
      </div>
    </div>

    <div class="container-fluid px-3 pb-2">
      <div class="d-flex gap-2 align-items-center">
        <div class="pill flex-grow-1">
          <i class="bi bi-calendar3"></i>
          <select class="form-select form-select-sm border-0 bg-transparent" id="monthSelect"></select>
        </div>
        <button class="btn btn-sm btn-outline-secondary" id="btnDemo" title="Dados demo">
          <i class="bi bi-magic"></i>
        </button>
        <div class="dropdown">
          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-three-dots"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><button class="dropdown-item" id="btnExport"><i class="bi bi-download me-2"></i>Exportar CSV</button></li>
            <li><button class="dropdown-item" id="btnBackup"><i class="bi bi-box-arrow-up me-2"></i>Backup (JSON)</button></li>
            <li><label class="dropdown-item" style="cursor:pointer">
              <i class="bi bi-box-arrow-in-down me-2"></i>Restaurar (JSON)
              <input type="file" id="restoreFile" accept="application/json" hidden>
            </label></li>
            <li><hr class="dropdown-divider"></li>
            <li><button class="dropdown-item text-danger" id="btnReset"><i class="bi bi-trash3 me-2"></i>Zerar dados</button></li>
          </ul>
        </div>
      </div>

      <div class="mt-2 searchbar">
        <i class="bi bi-search"></i>
        <input id="qSearch" class="form-control form-control-sm border-0 bg-transparent" placeholder="buscar por descrição ou categoria...">
      </div>
    </div>
  </header>

  <main class="container-fluid px-3 pb-6" id="main">
    <section id="view-home" class="view">
      <div class="balance-card mt-3">
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <div class="text-secondary small">Saldo atual</div>
            <div class="display-6 fw-semibold" id="kSaldo">R$ 0,00</div>
            <div class="small text-secondary"><i class="bi bi-clock-history me-1"></i><span id="lastUpdate">—</span></div>
          </div>
          <span class="badge-soft"><i class="bi bi-lock"></i> local</span>
        </div>

        <div class="row g-2 mt-2">
          <div class="col-4">
            <div class="mini-kpi">
              <div class="small text-secondary">Recebido</div>
              <div class="fw-semibold" id="kIn">R$ 0,00</div>
            </div>
          </div>
          <div class="col-4">
            <div class="mini-kpi">
              <div class="small text-secondary">Gasto</div>
              <div class="fw-semibold" id="kOut">R$ 0,00</div>
            </div>
          </div>
          <div class="col-4">
            <div class="mini-kpi">
              <div class="small text-secondary">Saldo mês</div>
              <div class="fw-semibold" id="kNet">R$ 0,00</div>
            </div>
          </div>
        </div>
      </div>


<div class="card glass mt-3" id="cardBudgetAlerts">
  <div class="card-header bg-transparent border-0 pb-0">
    <div class="fw-semibold">Alertas de metas</div>
    <div class="small text-secondary">mês selecionado</div>
  </div>
  <div class="card-body pt-2">
    <div id="budgetAlertsHome"></div>
  </div>
</div>

<div class="card glass mt-3" id="cardTopOut">
  <div class="card-header bg-transparent border-0 pb-0">
    <div class="fw-semibold">Top gastos</div>
    <div class="small text-secondary">mês selecionado</div>
  </div>
  <div class="card-body pt-2">
    <div id="topOutHome"></div>
  </div>
</div>



      <div class="card glass mt-3">
        <div class="card-header bg-transparent border-0 pb-0">
          <div class="fw-semibold">Gastos por categoria</div>
          <div class="small text-secondary">mês selecionado</div>
        </div>
        <div class="card-body pt-2">
          <canvas id="chartCat"></canvas>
          <div class="mt-3" id="catList"></div>
        </div>
      </div>

      <div class="card glass mt-3">
        <div class="card-header bg-transparent border-0 pb-0 d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-semibold">Entradas x Saídas</div>
            <div class="small text-secondary">últimos 30 dias</div>
          </div>
          <button class="btn btn-sm btn-outline-secondary" id="btnToday"><i class="bi bi-arrow-counterclockwise"></i></button>
        </div>
        <div class="card-body pt-2">
          <canvas id="chartDaily"></canvas>
        </div>
      </div>
      <div class="card glass mt-3">
        <div class="card-header bg-transparent border-0 pb-0">
          <div class="fw-semibold">Gastos (últimos 6 meses)</div>
          <div class="small text-secondary">comparativo por mês</div>
        </div>
        <div class="card-body pt-2">
          <canvas id="chartMonths"></canvas>
        </div>
      </div>

    </section>

    <section id="view-tx" class="view d-none">
      <div class="mt-3 d-flex gap-2">
        <div class="pill flex-grow-1">
          <i class="bi bi-funnel"></i>
          <select class="form-select form-select-sm border-0 bg-transparent" id="typeFilter">
            <option value="ALL" selected>Todos</option>
            <option value="IN">Ganhos</option>
            <option value="OUT">Gastos</option>
          </select>
        </div>
        <div class="pill">
          <i class="bi bi-calculator"></i>
          <span class="small fw-semibold" id="txSum">R$ 0,00</span>
        </div>
      </div>

      <div class="mt-2 d-flex gap-2 flex-wrap">
        <button class="btn btn-sm btn-outline-secondary" id="btnRangeToday">Hoje</button>
        <button class="btn btn-sm btn-outline-secondary" id="btnRange7">7d</button>
        <button class="btn btn-sm btn-outline-secondary" id="btnRange30">30d</button>
        <button class="btn btn-sm btn-outline-secondary" id="btnRangeMonth">Mês</button>
        <button class="btn btn-sm btn-outline-secondary" id="btnRangeAll">Tudo</button>
        <span class="small text-secondary align-self-center ms-auto" id="txRangeLabel">—</span>
      </div>

      <div class="mt-3 list-head d-flex align-items-center justify-content-between">
        <div class="small text-secondary" id="txCount">0 itens</div>
        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#filters">
          <i class="bi bi-sliders"></i> filtros
        </button>
      </div>

      <div class="mt-2 tx-list" id="txList"></div>
    </section>

<section id="view-budgets" class="view d-none">
      <div class="mt-3 d-flex justify-content-between align-items-center">
        <div>
          <div class="fw-semibold">Controle de gastos</div>
          <div class="small text-secondary">defina limites por categoria (mês selecionado)</div>
        </div>
        <button class="btn btn-sm btn-primary" id="btnAddBudget">
          <i class="bi bi-plus-lg me-1"></i>Nova meta
        </button>
      </div>

      <div class="mt-3" id="budgetList"></div>

      <div class="small text-secondary mt-3">
        Dica: quando o gasto passar de 80% aparece alerta; acima de 100% fica vermelho.
      </div>
    </section>
  </main>

  <nav class="bottom-nav">
    <button class="bn-item active" data-nav="home">
      <i class="bi bi-house"></i><span>Resumo</span>
    </button>
    <button class="bn-item" data-nav="tx">
      <i class="bi bi-receipt"></i><span>Lanç.</span>
    </button>
    <button class="bn-item" data-nav="budgets">
      <i class="bi bi-bullseye"></i><span>Metas</span>
    </button>

    <div class="bn-spacer"></div>

    <button class="bn-item" id="bnTheme">
      <i class="bi bi-circle-half"></i><span>Tema</span>
    </button>
    <button class="bn-item" data-bs-toggle="offcanvas" data-bs-target="#filters">
      <i class="bi bi-sliders"></i><span>Filtros</span>
    </button>
  </nav>

  <button class="fab" id="btnAddTx" aria-label="Novo lançamento">
    <i class="bi bi-plus-lg"></i>
  </button>

  <div class="offcanvas offcanvas-bottom rounded-top-4" tabindex="-1" id="filters">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Filtros</h5>
      <button class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <div class="mb-2">
        <label class="form-label small text-secondary">Buscar</label>
        <input class="form-control" id="qSearch2" placeholder="descrição, categoria...">
      </div>
      <div class="mb-2">
        <label class="form-label small text-secondary">Tipo</label>
        <select class="form-select" id="typeFilter2">
          <option value="ALL" selected>Todos</option>
          <option value="IN">Ganhos</option>
          <option value="OUT">Gastos</option>
        </select>
      </div>

      <div class="row g-2 mb-2">
        <div class="col-6">
          <label class="form-label small text-secondary">De</label>
          <input type="date" class="form-control" id="dateFrom2">
        </div>
        <div class="col-6">
          <label class="form-label small text-secondary">Até</label>
          <input type="date" class="form-control" id="dateTo2">
        </div>
      </div>
      <div class="small text-secondary mb-2">
        Se você preencher <b>De/Até</b>, o extrato usa o período (e ignora o mês do topo).
      </div>

      <div class="d-grid gap-2 mt-3">
        <button class="btn btn-primary" id="btnApplyFilters"><i class="bi bi-check2 me-1"></i>Aplicar</button>
        <button class="btn btn-outline-secondary" id="btnClearFilters"><i class="bi bi-eraser me-1"></i>Limpar</button>
      </div>
      <div class="small text-secondary mt-3">
        Dica: o mês é selecionado na barra superior.
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalTx" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4">
        <div class="modal-header">
          <h5 class="modal-title" id="txModalTitle">Novo lançamento</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="txId">
          <div class="row g-2">
            <div class="col-6">
              <label class="form-label">Data</label>
              <input type="date" class="form-control" id="txDate">
            </div>
            <div class="col-6">
              <label class="form-label">Tipo</label>
              <select class="form-select" id="txType">
                <option value="IN">Ganho (entrada)</option>
                <option value="OUT">Gasto (saída)</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">Descrição</label>
              <input class="form-control" id="txDesc" placeholder="ex.: salário, mercado, uber...">
            </div>
            <div class="col-6">
              <label class="form-label">Valor</label>
              <input class="form-control" id="txAmount" inputmode="decimal" placeholder="ex.: 120,50">
            </div>
            <div class="col-6">
              <label class="form-label">Categoria</label>
              <select class="form-select" id="txCat"></select>
              <input class="form-control mt-2" id="txCatNew" placeholder="nova categoria (opcional)">
            </div>
            <div class="col-12">
              <div class="alert alert-info mb-0">
                <i class="bi bi-info-circle me-1"></i>
                Os dados ficam salvos no seu dispositivo.
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-primary" id="btnSaveTx"><i class="bi bi-check2 me-1"></i>Salvar</button>
        </div>
      </div>
    </div>
  </div>


<div class="modal fade" id="modalBudget" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title" id="budgetModalTitle">Nova meta</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="budgetId" type="hidden"/>
        <div class="row g-2">
          <div class="col-12">
            <label class="form-label">Categoria</label>
            <select class="form-select" id="budgetCat"></select>
          </div>
          <div class="col-12">
            <label class="form-label">Limite do mês (R$)</label>
            <input class="form-control" id="budgetLimit" inputmode="decimal" placeholder="ex.: 1000,00"/>
            <div class="form-text">Ex.: Alimentação até 1000.</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-primary" id="btnSaveBudget"><i class="bi bi-check2 me-1"></i>Salvar</button>
      </div>
    </div>
  </div>
</div>



  <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index:2000;">
    <div id="appToast" class="toast" role="alert">
      <div class="toast-header">
        <i class="bi bi-bell me-2"></i>
        <strong class="me-auto">Finanças</strong>
        <small id="toastTime">agora</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
      </div>
      <div class="toast-body" id="toastBody">—</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="assets/js/app.js?v=1.2.1"></script>
</body>
</html>
